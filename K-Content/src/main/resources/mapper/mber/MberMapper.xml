<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.example.myapp.user.mber.dao.IMberRepository">

	<select id="selectMberbyId"
		resultType="com.example.myapp.user.mber.model.Mber">
			<![CDATA[
		    	SELECT A.mber_id,
					   A.mber_email,
					   A.mber_pwd,
					   A.mber_name,
					   A.mber_birth,
					   A.mber_phone,
					   A.mber_regist_date,
					   A.mber_update_date,
					   A.mber_gender_code,
					   A.mber_stat_code,
					   B.common_code_val
				FROM tb_mber A
		        JOIN tb_common_code B
		        ON A.mber_role_code = B.common_code
				WHERE mber_id= #{mberId}
		]]>
	</select>

	<select id="selectMberbyEmail"
		resultType="com.example.myapp.user.mber.model.Mber">
			<![CDATA[
			 	SELECT A.mber_id,
					   A.mber_email,
					   A.mber_pwd,
					   A.mber_name,
					   A.mber_birth,
					   A.mber_phone,
					   A.mber_regist_date,
					   A.mber_update_date,
					   A.mber_gender_code,
					   A.mber_stat_code,
					   B.common_code_val
				FROM tb_mber A
		        JOIN tb_common_code B
		        ON A.mber_role_code = B.common_code
				WHERE mber_Email=#{mberEmail}
			]]>
	</select>

	<select id="selectMberbyIdEmail"
		resultType="com.example.myapp.user.mber.model.Mber">
		<![CDATA[
			SELECT A.mber_id,
					   A.mber_email,
					   A.mber_pwd,
					   A.mber_name,
					   A.mber_birth,
					   A.mber_phone,
					   A.mber_regist_date,
					   A.mber_update_date,
					   A.mber_gender_code,
					   A.mber_stat_code,
					   B.common_code_val
			FROM tb_mber A
		    JOIN tb_common_code B
		    ON A.mber_role_code = B.common_code
			WHERE mber_id=#{mberId} AND mber_email= #{mberEmail}
		]]>
	</select>

	<select id="selectMberAllList"
		resultType="com.example.myapp.user.mber.model.Mber">
		<![CDATA[
			SELECT A.mber_id,
					   A.mber_email,
					   A.mber_pwd,
					   A.mber_name,
					   A.mber_birth,
					   A.mber_phone,
					   A.mber_regist_date,
					   A.mber_update_date,
					   A.mber_gender_code,
					   A.mber_stat_code,
					   B.common_code_val
			FROM tb_mber A
		    JOIN tb_common_code B
		    ON A.mber_role_code = B.common_code
		FROM tb_mber
		]]>
	</select>

	<insert id="insertMber" parameterType="String">
	    <![CDATA[
		INSERT INTO tb_mber (mber_id, mber_email, mber_pwd, mber_name, mber_birth, mber_phone, mber_regist_date,
							 mber_update_date, mber_gender_code, mber_stat_code, mber_role)
		VALUES (#{mberId}, #{mberEmail}, #{mberPwd}, #{mberName}, #{mberBirth}, #{mberPhone},
				to_char(sysdate, 'yyyy-mm-dd hh24:mi:ss'), null, #{mberGenderCode}, 'C0202', 'MBER_ROLE')
		]]>
	</insert>

	<update id="updateMber"
		parameterType="com.example.myapp.user.mber.model.Mber">
    <![CDATA[
		UPDATE tb_mber
		SET mber_email = #{mberEmail},
			mber_pwd = #{mberPwd},
			mber_name = #{mberName},
			mber_birth = #{mberBirth},
			mber_phone = #{mberPhone},
			mber_update_date = to_char(sysdate, 'yyyy-mm-dd hh24:mi:ss')
		WHERE mber_id = #{mberId}
		]]>
	</update>



	<select id="maskMberId" parameterType="String"
		resultType="String">
    <![CDATA[
		SELECT
			SUBSTR(mber_id, 1, 3) || RPAD('*', LENGTH(mber_id) - 2, '*')
		FROM tb_mber
		WHERE mber_email = #{mberEmail}
		]]>
	</select>

</mapper>
